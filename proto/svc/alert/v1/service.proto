syntax = "proto3";

package svc.alert.v1;

import "buf/validate/validate.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "types/v1/alert.proto";
import "types/v1/cursor.proto";
import "types/v1/query.proto";
import "types/v1/types.proto";

option go_package = "svc/query/v1;queryv1";

service AlertService {
  rpc CreateAlertGroup(CreateAlertGroupRequest) returns (CreateAlertGroupResponse);
  rpc GetAlertGroup(GetAlertGroupRequest) returns (GetAlertGroupResponse);
  rpc UpdateAlertGroup(UpdateAlertGroupRequest) returns (UpdateAlertGroupResponse);
  rpc DeleteAlertGroup(DeleteAlertGroupRequest) returns (DeleteAlertGroupResponse);
  rpc ListAlertGroup(ListAlertGroupRequest) returns (ListAlertGroupResponse);

  rpc CreateAlertRule(CreateAlertRuleRequest) returns (CreateAlertRuleResponse);
  rpc GetAlertRule(GetAlertRuleRequest) returns (GetAlertRuleResponse);
  rpc UpdateAlertRule(UpdateAlertRuleRequest) returns (UpdateAlertRuleResponse);
  rpc DeleteAlertRule(DeleteAlertRuleRequest) returns (DeleteAlertRuleResponse);
  rpc ListAlertRule(ListAlertRuleRequest) returns (ListAlertRuleResponse);
}

message CreateAlertGroupRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  types.v1.AlertGroupSpec spec = 1 [(buf.validate.field).required = true];
}

message CreateAlertGroupResponse {
  types.v1.AlertGroup alert_group = 1;
}

message GetAlertGroupRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string name = 1 [(buf.validate.field).required = true];
}

message GetAlertGroupResponse {
  types.v1.AlertGroup alert_group = 1;
}

message UpdateAlertGroupRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string name = 1 [(buf.validate.field).required = true];
  types.v1.AlertGroupSpec spec = 2 [(buf.validate.field).required = true];
}

message UpdateAlertGroupResponse {
  types.v1.AlertGroup alert_group = 1;
}

message DeleteAlertGroupRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string name = 1 [(buf.validate.field).required = true];
}

message DeleteAlertGroupResponse {}

message ListAlertGroupRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  types.v1.Cursor cursor = 2;
  int32 limit = 3;
}

message ListAlertGroupResponse {
  message ListItem {
    types.v1.AlertGroup alert_group = 2;
  }
  types.v1.Cursor next = 100;
  repeated ListItem items = 200;
}

message CreateAlertRuleRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string group_name = 103 [(buf.validate.field).required = true];
  string name = 1 [(buf.validate.field).required = true];
  types.v1.Query expr = 2 [(buf.validate.field).required = true];
  types.v1.Obj labels = 3;
  types.v1.Obj annotations = 4;
  google.protobuf.Duration for = 51;
  google.protobuf.Duration keep_firing_for = 52;
}

message CreateAlertRuleResponse {
  types.v1.AlertRule alert_rule = 1;
}

message GetAlertRuleRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string group_name = 103 [(buf.validate.field).required = true];
  string name = 1 [(buf.validate.field).required = true];
}

message GetAlertRuleResponse {
  types.v1.AlertRule alert_rule = 1;
}

message UpdateAlertRuleRequest {
  int64 environment_id = 101;
  string project_name = 102;
  string group_name = 103;

  types.v1.AlertRuleSpec spec = 1 [(buf.validate.field).required = true];
}

message UpdateAlertRuleResponse {
  types.v1.AlertRule alert_rule = 1;
}

message DeleteAlertRuleRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string group_name = 103 [(buf.validate.field).required = true];

  string name = 1 [(buf.validate.field).required = true];
}

message DeleteAlertRuleResponse {}

message ListAlertRuleRequest {
  int64 environment_id = 101;
  string project_name = 102 [(buf.validate.field).required = true];
  string group_name = 103 [(buf.validate.field).required = true];

  types.v1.Cursor cursor = 2;
  int32 limit = 3;
}

message ListAlertRuleResponse {
  message ListItem {
    types.v1.AlertRule alert_rule = 1;
  }
  types.v1.Cursor next = 100;
  repeated ListItem items = 200;
}
