syntax = "proto3";

package types.v1;

import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "types/v1/query.proto";
import "types/v1/types.proto";

option go_package = "types/v1;typesv1";

message AlertGroup {
  AlertGroupMeta meta = 1;
  AlertGroupSpec spec = 2;
  AlertGroupStatus status = 3;
}

message AlertGroupMeta {
  string id = 1;
}

message AlertGroupSpec {
  string name = 1;
  google.protobuf.Duration interval = 2;
  google.protobuf.Duration query_offset = 3;
  int32 limit = 4;
  repeated NamedAlertRuleSpec rules = 5;
  types.v1.Obj labels = 6;

  message NamedAlertRuleSpec {
    string id = 1;
    AlertRuleSpec spec = 2;
  }
}

message AlertGroupStatus {
  google.protobuf.Timestamp created_at = 1;
  google.protobuf.Timestamp updated_at = 2;
  repeated string errors = 3;
  repeated NamedAlertRuleStatus rules = 4;

  message NamedAlertRuleStatus {
    string id = 1;
    AlertRuleStatus status = 2;
  }
}

message AlertRule {
  AlertRuleMeta meta = 1;
  AlertRuleSpec spec = 2;
  AlertRuleStatus status = 3;
}

message AlertRuleMeta {
  // usually matches `spec.name` unless using virtual alert rules
  string id = 1;
}

message AlertRuleSpec {
  string name = 1;
  types.v1.Query expr = 2;
  types.v1.Obj labels = 3;
  types.v1.Obj annotations = 4;
  google.protobuf.Duration for = 51;
  google.protobuf.Duration keep_firing_for = 52;
}

message AlertRuleStatus {
  google.protobuf.Timestamp transitioned_at = 1;
  google.protobuf.Timestamp last_firing_at = 2;
  oneof status {
    AlertUnknown unknown = 300;
    AlertOk ok = 301;
    AlertPending pending = 302;
    AlertFiring firing = 303;
  }
}

message AlertUnknown {}
message AlertOk {}
message AlertPending {}
message AlertFiring {
  types.v1.Obj labels = 1;
}
